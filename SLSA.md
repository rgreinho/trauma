# SLSA

[SLSA] is a framework to guide developers and help them secure their software
supply chain.

In this document we are describing how we incrementally reach [SLSA] level 4,
and explain why we meet each criteria.

## SLSA 1

SLSA level 1 does not do much, but helps us get on track to build a resilient
system. We only have 2 requirements to satisfy.

### [Scripted Build]

> All build steps were fully defined in some sort of “build script”. The only
> manual command, if any, was to invoke the build script.

We use a GitHub Workflow to execute all the CI steps, so we're good here ✅.

### [Available Provenance]

> The provenance is available to the consumer in a format that the consumer
> accepts. The format SHOULD be in-toto SLSA Provenance, but another format MAY
> be used if both producer and consumer agree and it meets all the other
> requirements.

We provide provenance using the SLSA [github-actions-demo] and attach it to the
GitHub Release. So we're also good here ✅.

### Things to notice

- The attestation will not be uploaded to crates.io, but will live in GitHub
  release. This is not ideal and will complexify the process to verify it.
  Ideally all should be managed by `cargo.`
- The attestation does not mention which commit was used to build the crate.
- Following [cosign]'s convention, we named the attestation
  `trauma.${{ github.sha }}.att`

## SLSA 2

We keep adding to the security here, by requiring automated CI systems and
introducing signing.

### [Version Controlled Source]

> Every change to the source is tracked in a version control system that meets
> the following requirements:
>
> - [Change history] There exists a record of the history of changes that went
>   into the revision. Each change must contain: the identities of the uploader
>   and reviewers (if any), timestamps of the reviews (if any) and submission,
>   the change description/justification, the content of the change, and the
>   parent revisions.
> - [Immutable reference] There exists a way to indefinitely reference this
>   particular, immutable revision. In git, this is the {repo URL +
>   branch/tag/ref + commit ID}.

We are using `git` as our CVS, which meets these requirements, so we're good
here ✅.

### [Build Service]

> All build steps ran using some build service, not on a developer’s
> workstation.

We use GitHub Actions as the automated build system, so we're good here ✅.

### [Authenticated Provenance]

> The provenance’s authenticity and integrity can be verified by the consumer.
> This SHOULD be through a digital signature from a private key accessible only
> to the service generating the provenance.

For this requirement, we are using [cosign] to sign the provenance attestation.
The attestation signature will be attached to the GitHub release, next to the
attestation itself.

Here is the trauma public key `trauma.pub`:

```pgp
-----BEGIN PUBLIC KEY-----
MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE9REilH9skU+RaK9Pcs3PhAKOSsjH
hSt+Gu73ChvvFNZd5u9LDU7BpdJUG5vKBVMaHnOlPY1Az/dC2DxqQa5iRQ==
-----END PUBLIC KEY-----
```

The signature could be verified using cosign as well:

```bash
$ cosign verify-blob --key trauma.pub --signature trauma.sig trauma.att
Verified OK
```

And we're good here ✅.

### [Service generated Provenance]

> The data in the provenance MUST be obtained from the build service (either
> because the generator is the build service or because the provenance generator
> reads the data directly from the build service).
>
> Regular users of the service MUST NOT be able to inject or alter the contents,
> except as noted below.
>
> The following provenance fields MAY be generated by the user-controlled build
> steps:
>
> - The output artifact hash from Identifies Artifact. Reasoning: This only
>   allows a “bad” build to falsely claim that it produced a “good” artifact.
>   This is not a > security problem because the consumer MUST accept only
>   “good” builds and reject “bad” builds.
> - The “reproducible” boolean and justification from Reproducible.

We are generating the provenance as a step in our GitHub Workflow, so we're good
here ✅.

[authenticated provenance]:
  https://slsa.dev/spec/v0.1/requirements#authenticated
[available provenance]: https://slsa.dev/spec/v0.1/requirements#available
[build service]: https://slsa.dev/spec/v0.1/requirements#build-service
[cosign]: https://github.com/sigstore/cosign
[github-actions-demo]: https://github.com/slsa-framework/github-actions-demo
[scripted build]: https://slsa.dev/spec/v0.1/requirements#scripted-build
[service generated provenance]:
  https://slsa.dev/spec/v0.1/requirements#service-generated
[slsa]: https://slsa.dev/
[slsa levels]: https://slsa.dev/spec/v0.1/levels
[version controlled source]:
  https://slsa.dev/spec/v0.1/requirements#version-controlled
